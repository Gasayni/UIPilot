// 3. Гаджи. ПочтаРоссии. Оформляем доставку на

// 1. будет брать данные с таблицы  и сохранять в переменные
log
log   Скрипт 3 стартовал!



set #edge Findwindow (Edge)
//set #edge WindowFromCursor
// Привязываемся к окну, чтобы работала смена раскладки клавиатуры
set workwindow #edge
log    привязались к окну








// Загружаем данные из 2 скрипта
set $login $login.2
set $pass $pass.2
set $nameSender $nameSender.2
set $addressSender $addressSender.2
set $indexSender $indexSender.2
set $phoneSender $phoneSender.2
// Загружаем еще данные из скрипта
set $nameProduct $nameProduct.2
set $countProduct $countProduct.2
set $weightProduct $weightProduct.2
set $costProduct $costProduct.2
set $currency $currency.2
set $tnved $tnved.2
set $countryMade $countryMade.2
set $iossVat $iossVat.2
set $nameRecepient $nameRecepient.2
set $addressRecepient $addressRecepient.2
set $localRecepient $localRecepient.2
set $indexRecepient $indexRecepient.2
set $counrtyRecepient $counrtyRecepient.2
set $phoneRecepient $phoneRecepient.2
set $emailRecepient $emailRecepient.2
log    загрузили данные из предыдущего скрипта


//log ...
//log login $login
//log pass $pass
//log nameSender $nameSender
//log addressSender $addressSender
//log indexSender $indexSender
//log phoneSender $phoneSender

//log nameProduct $nameProduct
//log countProduct $countProduct
//log weightProduct $weightProduct
//log costProduct $costProduct
//log currency $currency
//log tnved $tnved
//log countryMade $countryMade
//log iossVat $iossVat
//log nameRecepient $nameRecepient
//log addressRecepient $addressRecepient
//log localRecepient $localRecepient
//log indexRecepient $indexRecepient
//log counrtyRecepient $counrtyRecepient
//log phoneRecepient $phoneRecepient
//log emailRecepient $emailRecepient
//msg
//end_script



log  Перешли на сайт Почты Росии
// Проверка, сохранилась ли авторизация
// включаем поиск и пишем слово "войти"
log    запускаем проверку авторизации
wait 1s
sendex ^f
set clipboard Войти
sendex ^v
sendex {Enter}
sendex {Esc}
set clipboard ...
sendex ^с
get clipboard $voyti
if  $voyti != Войти
   log    Ошибка авторизации! (кто-то не вышел из аккаунта)
   log    выходим из аккаунта
   // если уже кто-то вошел, то нужно сначала выйти из аккаунта
   // включаем поиск и пишем слово "помощь"
   sendex ^f
   set clipboard Помощь
   sendex ^v
   sendex {Esc}
   wait 500

   move 1307 130 abs
   repeat 4
      sendex {Tab}
   end_repeat
   sendex {Enter}
   wait 10s
else
   log    Авторизация успешно! (не был Авторизован)
   goto succsessLogout
end_if



// нажимаем главной странице "войти"
log    переходим на страницу авторизации
// включаем поиск и пишем слово "войти"
sendex ^f
wait 1s
set clipboard Войти
sendex ^v
sendex {Enter}
sendex {Esc}
wait 1s

// если не логинились, быстрее
:succsessLogout
sendex {Enter}
wait 10s

// логинимся
log    авторизуемся
double_kleft 790 323 abs
wait 300
sendex {Tab}
sendex {Backspace}
log    вызываем процедуру правильного ввода логина
set clipboard $login
sendex ^v
wait 300
sendex {Tab}
sendex {Backspace}
set clipboard $pass
sendex ^v
log    ввели пароль: $pass

sendex {Tab}
sendex {Enter}
wait 5s


log    перешли на главную страницу (но уже залогинились)
// Перешли на главную страницу (но уже залогинились)
// включаем поиск и пишем слово "отправить"
sendex ^f
set clipboard отправить
sendex ^v
sendex {Esc}
sendex {Tab}
sendex {Tab}
sendex {Enter}
wait 5s



// Перешли на страницу оформления посылки
log    перешли на страницу оформления посылки
log    Заполняем поля
// включаем поиск и пишем слово "откуда"
sendex ^f
set clipboard откуда
sendex ^v
sendex {Esc}
sendex {Tab}
// заполняем поле "откуда"(адрес отправителя)
sendex ^a
wait 300
sendex {Backspace}
sendex {Backspace}
set clipboard $addressSender
sendex ^v
wait 2s
sendex {Down}
sendex {Enter}
wait 1s
sendex {Tab}
log    адрес отправителя $addressSender


// заполняем поле "куда"(страну получателя)
// в зависимости от значения переменной $counrtyRecepient, мы д. выбирать страну
// если USA -- Соединенные Штаты Америки
// и т.д.
set $i Uncknow
switch $counrtyRecepient
   case USA:
      set $counrty Соединенные Штаты Америки
      hint США
      break
   case UK:
      set $counrty Великобритания
      break
   case Croatia:
      set $counrty Хорватия
      break
end_switch
// Если ни одна Валюта не подошла
if  #counrty = Uncknow
   alarm
   msg Выборка по Стране не прошла
   end_script
end_if

sendex ^a
sendex {Backspace}
set clipboard $counrty
sendex ^v
log    страна получателя $counrty
wait 2s
sendex {Down}
sendex {Enter}
wait 1s
sendex {Tab}
// заполняем поле "вес посылки"
sendex ^a
sendex {Backspace}
set clipboard $weightProduct
sendex ^v
wait 2s
sendex {Down}
sendex {Enter}
log    вес посылки $weightProduct
wait 2s

sendex {Tab}
sendex {Tab}
wait 3s
// меняем способ доставки на ускоренный
sendex {Right}
wait 3s
// нажимаем на "перейти к оформлению"
sendex {Tab}
sendex {Tab}
sendex {Enter}
log    поменяли способ доставки на ускоренный
wait 5s



// Перешли на страницу оформления посылки 2часть
// включаем поиск и пишем слово "отправитель"
sendex ^f
set clipboard отправитель
sendex ^v
sendex {Esc}
sendex {Tab}
// заполняем поле "имя отправителя"
sendex {Backspace}
set clipboard $nameSender
sendex ^v
sendex {Tab}
sendex {Tab}
sendex {Tab}

// заполняем поле "телефон отправителя"
sendex {Backspace}
set clipboard $phoneSender
sendex ^v
sendex {Tab}
// очищаем поле "email"
sendex {Backspace}
sendex {Tab}
sendex {Tab}




// Заполняем данные получателя
// заполняем поле "получатель"
sendex {Backspace}
set clipboard $nameRecepient
sendex ^v
sendex {Tab}
wait 300
// заполняем поле "населенный пункт"
sendex {Backspace}
set clipboard $localRecepient
sendex ^v
sendex {Tab}
wait 300
// заполняем поле "адрес"
sendex {Backspace}
set clipboard $addressRecepient
sendex ^v
sendex {Tab}
wait 300
// заполняем поле "индекс"
sendex {Backspace}

set clipboard $indexRecepient
sendex ^v
sendex {Tab}
wait 300
// заполняем поле "телефон"
sendex {Backspace}

set clipboard $phoneRecepient
sendex ^v
sendex {Tab}
wait 300
sendex {Backspace}
// если $emailOrder не пустой(если внутри полученного $emailRecepient есть знак "@")
// заполняем поле "email"
set #n posex(@ $emailOrder)
if  #n != 0
   set clipboard $emailOrder
   sendex ^v
end_if
sendex {Tab}
wait 1s






// Заполняем данные о товарах
// включаем поиск и пишем слово "категория отправления"
sendex ^f
set clipboard категория отправления
sendex ^v
sendex {Esc}
sendex {Tab}
wait 300
// выбираем "продажа товаров"
kleft 440 810 abs
sendex {Tab}
sendex {Tab}
sendex {Tab}
sendex {Tab}
sendex {Enter}
sendex {Tab}



// заполняем поле "валюта"
// в зависимости от значения переменной $currency, мы д. выбирать
// если USD -- то доллар
// если EUR -- то евро
// если GBP -- то фунты
set #i 1
switch $currency
   case USD: set #i 2   //  Доллар
      break
   case EUR: set #i 3  //  Евро
      break
   case GBP: set #i 4  //  Фунты
      break
end_switch
// Если ни одна Валюта не подошла
if  #i = 1
   msg Выборка по Валюте не прошла
   end_script
end_if

// Если все прошло нормально
// поиск
sendex ^f
set clipboard Оформить посылку
sendex ^v
sendex {Enter}
wait 1s
sendex ^a
set clipboard Валюта
sendex ^v
sendex {Enter}
sendex {Esc}

//sendex {Tab}
kleft 480 480 abs
wait 1s
//kleft 700 480 abs
Repeat #i
   sendex {Tab}
End_Repeat
sendex {Enter}
//wait 1s
sendex {Tab}
sendex {Tab}



// заполним таблицу "Описание товарных вложений"

// заполним поле "наименование предмета"
sendex {Backspace}
set clipboard $nameProduct
sendex ^v
sendex {Tab}
// заполним поле "кол-во"
sendex {Backspace}
set clipboard $countProduct
sendex ^v
sendex {Tab}
// заполним поле "Общий вес, кг"
sendex {Backspace}
set clipboard $weightProduct
sendex ^v
//set $w setselectedtext $weightProduct
sendex {Tab}


// заполним поле "общая стоимость"
sendex {Backspace}
set clipboard $costProduct
sendex ^v
sendex {Tab}
// заполним поле "код ТНВЭД"
sendex {Backspace}
set clipboard $tnved
sendex ^v
sendex {Tab}

// заполним поле "страна происхождения"
// в зависимости от значения переменной $countryMade, мы выбираем страну происхождения товара
// если Russian Federation -- r+{Down}
// если India -- i+{Down}
// если China -- c+{Down}x8
set #i 0
switch $countryMade
   case Russian Federation:
      set $char r
      set #i 1
      break
   case India:
      set $char i
      set #i 1
      break
   case China:
      set $char c
      set #i 8
      break
end_switch
// Если ни одна Страна не подошла
if  i = 0
   alarm
   msg Выборка по Стране не прошла
   end_script
end_if

// Если все прошло нормально
//log Выборка по Стране удачно
sendex {Enter}
wait 300
set $var setlayout (00000409)  // раскладка ENG
sendex $char
wait 300

Repeat #i
   sendex {Down}
End_Repeat
wait 300
sendex {Enter}

wait 2s



// выбираем способ оплаты - "в отделении"
// включаем поиск и пишем слово "способ оплаты"
sendex ^f
set clipboard способ оплаты
sendex ^v
sendex {Enter}
sendex {Esc}
sendex {Tab}
sendex {Right}
wait 1s
// нажимаем "получить трек-номер"
sendex {Tab}
sendex {Tab}
sendex {Enter}
wait 10s



// Далее, нам нужно скопировать и присвоить полученный трек-номер в переменную
// включаем поиск и пишем слово "RR"
sendex ^f
wait 1s
set clipboard RR
sendex ^v
sendex {Enter}
sendex {Esc}
wait 1s
// выделяем все слово и копируем в буфер обмена
sendex ^~{Right}
sendex ^c
get clipboard $trackNumber
sendex {Enter}





// Теперь нам нужно выйти из логина
// включаем поиск и пишем слово "помощь"
log    выходим из аккаунта
sendex ^f
set clipboard Помощь
sendex ^v
sendex {Enter}
sendex {Esc}
wait 500

move 1407 130 abs
repeat 5
   sendex {Tab}
end_repeat
sendex {Enter}
// мы итак ждем, когда загрузили следующий скрипт
wait 5s




log    загружаем следующий скрипт(4_Put_trackNumber.txt)
// загружаем следующий скрипт
load_script 4 4_Put_trackNumber.txt
// запустить скрипт в 3 вкладке
start_script 4
// Ждем, даем время другому скрипту забрать из этого скрипта данные
wait 5s



log    Скрипт 3 завершился!
end_script