                                // 1. Гаджи. ПочтаРоссии. Первый скрипт

log  ...
log  ...
log  ...
log   Скрипт 1 стартовал!

// 1. будет брать данные с таблиц и сохранять в переменные

// Открываем браузер (Edge)
exec "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe"
wait 4s
log  Открыли браузер

// Привязываемся к окну, чтобы работала смена раскладки клавиатуры
set #edgeTable Findwindow (Edge)
set workwindow #edgeTable
log  привязались к рабочему окну

//Развернуть активное окно на весь экран
showwindow #edgeTable MAXIMIZE
wait 300
log  Развернули окно на весь экран







// Переходим к адресной строке
sendex ^l
log  открыли адресную строку
set clipboard "https://docs.google.com/spreadsheets/"
sendex ^v
sendex {Enter}
wait 10s
log  Перешли на страницу со всеми таблицами




   // Страница со всеми таблицами

// включаем поиск и пишем название таблицы
sendex ^f
set clipboard почта - доставка
sendex ^v
sendex {Enter}
sendex {Esc}
sendex {Enter}
wait 10s




   // страница рабочей таблицы
log  Перешли на страницу с рабочей таблицей
// Проверим не перекинул ли нас сайт на страницу входа (5 раз)
log  проверка листа
// заодно проверим, тот ли лист
Repeat 5
   // ищем по "флаг2"
   sendex ^f
   set clipboard флаг2
   sendex ^v)
   sendex {Enter}
   sendex {Esc}
   sendex {F2}
   sendex ^a
   sendex ^c
   get clipboard $flag2
   sendex {Esc}
   if  $flag2 != флаг2
      // если не прошло, возможно это не тот лист, перейдем на следующий лист
      log  Переключаемся на следующий лист
      sendex @{Down}
   else
      log  Проверка прошла успешно
      goto successFlag
   end_if
End_Repeat

// аварийный выход
msg Войдите в свой аккаунт и запустите этот скрипт снова!
end_script








// Проверку прошел. Все хорошо, продолжаем
:successFlag
// Можем работать с таблицей
// переходим к флагу(!)
sendex ^{Down}
log  Работаем с таблицей

log  Забираем данные из таблицы
// забираем в переменную логин
sendex {Right}
sendex {F2}
sendex ^a
sendex ^c
get clipboard $login
sendex {Esc}
log  логин $login

// забираем в переменную пароль
sendex {Right}
sendex {F2}
sendex ^a
sendex ^c
get clipboard $pass
sendex {Esc}
log  пароль $pass

// забираем в переменную фио отправителя
sendex {Right}
sendex {F2}
sendex ^a
sendex ^c
get clipboard $nameSender
sendex {Esc}
log фио отправителя $nameSender

// забираем в переменную индекс отправителя
sendex {Right}
sendex {F2}
sendex ^a
sendex ^c
get clipboard $indexSender
sendex {Esc}
log  индекс отправителя $indexSender

// забираем в переменную адрес отправителя
sendex {Right}
sendex {F2}
sendex ^a
sendex ^c
get clipboard $addressSender
sendex {Esc}
log  адрес отправителя $addressSender

// забираем в переменную телефон отправителя
sendex {Right}
sendex {F2}
sendex ^a
sendex ^c
get clipboard $phoneSender
log  телефон оптравителя $phoneSender
// вызываем процедуру, кот оставит от номера только последние 10 цифр
log  вызываем процедуру редактирования нормеа
call phoneEditProcedure $phoneSender
set $phoneSender $phoneEditProcedure
log  телефон отправителя(исправленный) $phoneSender
sendex {Esc}


log  сдвигаем флаг
// Теперь м. сдвинуть флаг на следующий заказ
// переходим к началу строки
sendex {Home}
// вырезаем ячейку
sendex ^x
// вставляем ячейку ниже
sendex {Down}
sendex ^v
sendex {Esc}




log  Загружаем и запускаем следующий скрипт(2_Take_OrderData.txt)
// загружаем следующий скрипт
load_script 2 2_Take_OrderData.txt
// запустить скрипт в 2 вкладке
start_script 2
// Ждем, даем время другому скрипту забрать из этого скрипта данные
wait 10s

log  Скрипт 1 завершился!
end_script


// процедура для редактирования номера телефона
// процедура б. оставлять последние 10 цифр от полученного номера
proc phoneEditProcedure $phoneSender
log  Внутри редактирования телефонного номера
set #sizeLine size($phoneSender)
set #n #sizeLine - 10
// удаляем с 1й позиции #n символов, т. е. убираем префикс номера
set $result Delete($phoneSender 1 #n)
end_proc
